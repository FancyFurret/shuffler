@inherits ObserverComponent
@using Shuffler.Core

@inject ShufflerCore Core

@if (!ShouldShowLoading)
{
    @ChildContent
}
else
{
    <div class="flex items-center justify-center h-full">
        <div class="flex flex-col items-center gap-4">
            <div
                class="w-16 h-16 border-4 border-t-primary border-r-primary border-b-primary/30 border-l-primary/30 rounded-full animate-spin">
            </div>
            <div class="text-lg font-medium text-foreground-400">Loading...</div>
        </div>
    </div>
}

@code {
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    [Parameter]
    public bool ShowOnlyFirstLoad { get; set; }

    private bool _hasLoadedOnce;
    private bool IsLoading => Observe(Core.IsLoading);

    private bool ShouldShowLoading
    {
        get
        {
            if (!IsLoading)
            {
                _hasLoadedOnce = true;
                return false;
            }

            if (ShowOnlyFirstLoad && _hasLoadedOnce)
                return false;

            return true;
        }
    }
}